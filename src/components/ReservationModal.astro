---
// src/components/ReservationModal.astro
---
<div id="reservationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-0 sm:p-4 z-50 hidden">
  <div class="bg-gray-900 rounded-t-2xl sm:rounded-lg shadow-2xl w-full h-full sm:h-auto sm:max-w-lg md:max-w-xl border border-gray-700 transform transition-all duration-300 scale-95 opacity-0 modal-content flex flex-col">
    <!-- Header -->
    <div class="flex items-center justify-between p-4 sm:p-6 bg-gradient-to-r from-green-700 to-green-600 rounded-t-2xl">
      <h3 class="text-lg sm:text-2xl font-bold text-white">
        Reservar Espacio <span id="modalSpaceNumber" class="text-yellow-300">#</span>
      </h3>
      <button id="closeModal" class="text-gray-200 hover:text-white transition-colors">
        <svg class="w-6 h-6 sm:w-7 sm:h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Contenido con scroll -->
    <div class="p-4 sm:p-6 space-y-6 text-sm sm:text-base overflow-y-auto flex-1">
      <!-- Descripción -->
      <div>
        <h4 class="text-base sm:text-lg font-semibold text-gray-200 mb-3">Descripción del Espacio</h4>
        <div class="bg-gray-800 p-3 sm:p-4 rounded-lg shadow-inner text-xs sm:text-sm">
          <p class="text-gray-300 mb-2"><span class="font-semibold">Ubicación:</span> <span id="spaceLocation"></span></p>
          <p class="text-gray-300 mb-2"><span class="font-semibold">Tipo:</span> Espacio estándar para vehículo</p>
          <p class="text-gray-300"><span class="font-semibold">Características:</span> Techado, seguro, acceso 24/7</p>
        </div>
      </div>

      <!-- Días -->
      <div>
        <h4 class="text-base sm:text-lg font-semibold text-gray-200 mb-3">Selecciona los días</h4>
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-2 sm:gap-3">
          {[1, 2, 3, 4, 5].map(day => (
            <button 
              class="day-btn bg-gray-700 hover:bg-green-600 text-white py-2 sm:py-3 px-2 sm:px-4 rounded-lg transition-all duration-200 border border-gray-600 hover:border-green-500 text-sm sm:text-base font-medium shadow-sm"
              data-days={day}
            >
              {day} día{day > 1 ? 's' : ''}
            </button>
          ))}
        </div>
        <p class="text-gray-400 text-xs sm:text-sm mt-2">Selecciona la cantidad de días que necesitas el espacio</p>
      </div>

      <!-- Precios -->
      <div>
        <h4 class="text-base sm:text-lg font-semibold text-gray-200 mb-3">Precios</h4>
        <div class="space-y-2 sm:space-y-3">
          {[ 
            { d:1, t:"₲200.000" }, 
            { d:2, t:"₲390.000", s:"(Ahorra ₲10.000)" },
            { d:3, t:"₲560.000", s:"(Ahorra ₲40.000)" },
            { d:4, t:"₲750.000", s:"(Ahorra ₲50.000)" },
            { d:5, t:"₲900.000", s:"(Ahorra ₲100.000)", special:true }
          ].map(price => (
            <div class={`flex justify-between items-center p-2 sm:p-3 rounded-lg transition-all ${price.special ? "bg-gradient-to-r from-green-700 to-green-600 border border-green-500" : "bg-gray-800 hover:bg-gray-700"}`}>
              <span class={`text-gray-200 ${price.special ? "font-semibold text-white" : ""}`}>{price.d} día{price.d>1?'s':''} {price.special ? '(Super Combo)' : ''}</span>
              <span class={`font-bold ${price.special ? "text-yellow-300" : "text-green-400"}`}>{price.t} {price.s && <span class="text-xs text-gray-400"> {price.s}</span>}</span>
            </div>
          ))}
        </div>
      </div>

      <!-- Total -->
      <div class="p-3 sm:p-4 bg-gradient-to-r from-green-700 to-green-600 rounded-lg border border-green-500 shadow-lg">
        <div class="flex justify-between items-center">
          <span class="text-white font-semibold text-sm sm:text-lg">Total seleccionado:</span>
          <span id="totalPrice" class="text-white font-bold text-lg sm:text-xl">₲0</span>
        </div>
      </div>
    </div>

    <!-- Botón flotante en móviles -->
    <div class="p-4 bg-gray-900 border-t border-gray-700">
      <button 
        id="reserveBtn" 
        class="w-full flex items-center justify-center gap-2 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 text-white font-bold py-3 sm:py-4 px-3 sm:px-4 rounded-lg transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 shadow-lg text-sm sm:text-base"
        disabled
      >
        <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="currentColor" viewBox="0 0 24 24">
          <path d="M21 11.5a8.38 8.38 0 01-.9 3.8l-1.4-1.4a1 1 0 00-1.4 0l-2 2a1 1 0 000 1.4l1.4 1.4a8.38 8.38 0 01-3.8.9A8.5 8.5 0 113 12a8.5 8.5 0 0118 0z"/>
        </svg>
        Reservar por WhatsApp
      </button>
    </div>
  </div>
</div>

<style>
#reservationModal .modal-content {
  animation: showModal 0.3s ease-out forwards;
}
@keyframes showModal {
  from { transform: scale(0.9); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}
</style>


<script>
  let selectedSpace = null;
  let selectedDays = null;
  
  const prices = {
    1: 200.000,
    2: 390.000,
    3: 560.000,
    4: 750.000,
    5: 900.000  };
  
  const locations = {
    1: "Fila superior - Izquierda", 2: "Fila superior - Centro izquierda", 3: "Fila superior - Centro",
    4: "Fila superior - Centro derecha", 5: "Fila superior - Derecha", 6: "Fila superior - Extremo derecha",
    7: "Lateral izquierdo - Superior", 8: "Lateral izquierdo - Centro superior", 9: "Lateral izquierdo - Centro",
    10: "Lateral izquierdo - Centro inferior", 11: "Lateral izquierdo - Inferior", 12: "Lateral izquierdo - Extremo inferior",
    13: "Lateral derecho - Superior", 14: "Lateral derecho - Centro superior", 15: "Lateral derecho - Centro",
    16: "Lateral derecho - Centro inferior", 17: "Lateral derecho - Inferior", 18: "Lateral derecho - Extremo inferior",
    19: "Fila inferior - Izquierda", 20: "Fila inferior - Centro izquierda", 21: "Fila inferior - Centro",
    22: "Fila inferior - Centro derecha", 23: "Fila inferior - Derecha", 24: "Fila inferior - Extremo derecha"
  };
  
  document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('reservationModal');
    const closeBtn = document.getElementById('closeModal');
    const dayButtons = document.querySelectorAll('.day-btn');
    const reserveBtn = document.getElementById('reserveBtn');
    const totalPrice = document.getElementById('totalPrice');
    const selectedDaysText = document.getElementById('selectedDaysText');
    const modalSpaceNumber = document.getElementById('modalSpaceNumber');
    const spaceLocation = document.getElementById('spaceLocation');
    
    // Escuchar evento personalizado para abrir modal
    window.addEventListener('openReservationModal', (e) => {
      selectedSpace = e.detail.spaceNumber;
      modalSpaceNumber.textContent = selectedSpace;
      spaceLocation.textContent = locations[selectedSpace];
      modal.classList.remove('hidden');
    });
    
    // Cerrar modal
    closeBtn.addEventListener('click', () => {
      modal.classList.add('hidden');
      resetModal();
    });
    
    // Cerrar modal al hacer click fuera
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.classList.add('hidden');
        resetModal();
      }
    });
    
    // Selección de días
    dayButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        // Remover selección anterior
        dayButtons.forEach(b => {
          b.classList.remove('bg-blue-600', 'border-blue-500');
          b.classList.add('bg-gray-700', 'border-gray-600');
        });
        
        // Agregar selección actual
        btn.classList.remove('bg-gray-700', 'border-gray-600');
        btn.classList.add('bg-blue-600', 'border-blue-500');
        
        selectedDays = parseInt(btn.getAttribute('data-days'));
        updatePrice();
        reserveBtn.disabled = false;
      });
    });
    
    // Botón de reservar
    reserveBtn.addEventListener('click', () => {
      if (selectedSpace && selectedDays) {
        const message = `Hola! Quiero reservar el espacio de estacionamiento número #${selectedSpace} por ${selectedDays} días${selectedDays > 1 ? 's' : ''} (Total: $${prices[selectedDays]})`;
        const whatsappUrl = `https://wa.me/+595982473466?text=${encodeURIComponent(message)}`;
        window.open(whatsappUrl, '_blank');
      }
    });
    
    function updatePrice() {
      if (selectedDays) {
        totalPrice.textContent = `$${prices[selectedDays]}`;
        selectedDaysText.textContent = `${selectedDays} día${selectedDays > 1 ? 's' : ''} seleccionado${selectedDays > 1 ? 's' : ''}`;
      }
    }
    
    function resetModal() {
      selectedSpace = null;
      selectedDays = null;
      reserveBtn.disabled = true;
      totalPrice.textContent = '$0';
      selectedDaysText.textContent = 'Selecciona los días para ver el precio';
      
      // Reset day buttons
      dayButtons.forEach(btn => {
        btn.classList.remove('bg-blue-600', 'border-blue-500');
        btn.classList.add('bg-gray-700', 'border-gray-600');
      });
    }
  });
</script>